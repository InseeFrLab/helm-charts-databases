{
	"$schema": "http://json-schema.org/schema#",
	"type": "object",
	"properties": {
		"service": {
			"description": "Service specific configuration",
			"type": "object",
			"properties": {
				"image": {
					"description": "image docker",
					"type": "object",
					"properties": {
						"pullPolicy": {
							"type": "string",
							"description": "option when pulling the docker image",
							"default": "IfNotPresent",
							"enum": ["IfNotPresent", "Always", "Never"]
						},
						"version": {
							"description": "supported versions",
							"type": "string",
							"listEnum": [
								"dbeaver/cloudbeaver:22.2.4",
								"inseefrlab/cloudbeaver:23.0.3"
							],
							"render": "list",
							"pattern": "^[a-z0-9-_./]+(:[a-z0-9-_.]+)?$",
							"default": "dbeaver/cloudbeaver:22.2.4"
						}
					}
				}
			}
		},
		"resources": {
			"description": "Your service will have at least the requested resources and never more than its limits. No limit for a resource and you can consume everything left on the host machine.",
			"type": "object",
			"properties": {
				"requests": {
					"description": "Guaranteed resources",
					"type": "object",
					"properties": {
						"cpu": {
							"description": "The amount of cpu guaranteed",
							"title": "CPU",
							"type": "string",
							"default": "100m",
							"render": "slider",
							"sliderMin": 50,
							"sliderMax": 8000,
							"sliderStep": 100,
							"sliderUnit": "m",
							"sliderExtremity": "down",
							"sliderExtremitySemantic": "guaranteed",
							"sliderRangeId": "cpu"
						},
						"memory": {
							"description": "The amount of memory guaranteed",
							"title": "memory",
							"type": "string",
							"default": "2Gi",
							"render": "slider",
							"sliderMin": 1,
							"sliderMax": 8,
							"sliderStep": 1,
							"sliderUnit": "Gi",
							"sliderExtremity": "down",
							"sliderExtremitySemantic": "guaranteed",
							"sliderRangeId": "memory"
						}
					}
				},
				"limits": {
					"description": "max resources",
					"type": "object",
					"properties": {
						"cpu": {
							"description": "The maximum amount of cpu",
							"title": "CPU",
							"type": "string",
							"default": "2000m",
							"render": "slider",
							"sliderMin": 50,
							"sliderMax": 8000,
							"sliderStep": 100,
							"sliderUnit": "m",
							"sliderExtremity": "up",
							"sliderExtremitySemantic": "Maximum",
							"sliderRangeId": "cpu"
						},
						"memory": {
							"description": "The maximum amount of memory",
							"title": "Memory",
							"type": "string",
							"default": "4Gi",
							"render": "slider",
							"sliderMin": 1,
							"sliderMax": 8,
							"sliderStep": 1,
							"sliderUnit": "Gi",
							"sliderExtremity": "up",
							"sliderExtremitySemantic": "Maximum",
							"sliderRangeId": "memory"
						}
					}
				}
			}
		},
		"security": {
			"description": "security specific configuration",
			"type": "object",
			"properties": {
				"username": {
					"type": "string",
					"form": true,
					"title": "Admin username",
					"x-form": {
						"value": "{{project.id}}"
					},
					"x-onyxia": {
						"overwriteDefaultWith": "{{project.id}}"
					}
				},
				"password": {
					"type": "string",
					"description": "Password",
					"default": "changeme",
					"x-form": {
						"value": "{{project.password}}"
					},
					"x-onyxia": {
						"overwriteDefaultWith": "{{project.password}}"
					}
				},
				"allowlist": {
					"type": "object",
					"description": "IP protection",
					"properties": {
						"enabled": {
							"type": "boolean",
							"title": "Enable IP protection",
							"description": "Only the configured set of IPs will be able to reach the service",
							"default": true,
							"x-form": {
								"value": "{{region.defaultIpProtection}}"
							},
							"x-onyxia": {
								"overwriteDefaultWith": "region.defaultIpProtection"
							}
						},
						"ip": {
							"type": "string",
							"description": "the white list of IP is whitespace",
							"title": "Whitelist of IP",
							"default": "0.0.0.0",
							"x-form": {
								"value": "{{user.ip}}"
							},
							"x-onyxia": {
								"overwriteDefaultWith": "{{user.ip}}"
							},
							"hidden": {
								"value": false,
								"path": "security/allowlist/enabled"
							}
						}
					}
				},
				"networkPolicy": {
					"type": "object",
					"description": "Define access policy to the service",
					"properties": {
						"enabled": {
							"type": "boolean",
							"title": "Enable network policy",
							"description": "Only pod from the same namespace will be allowed",
							"default": true,
							"x-form": {
								"value": "{{region.defaultNetworkPolicy}}"
							},
							"x-onyxia": {
								"overwriteDefaultWith": "region.defaultNetworkPolicy"
							}
						},
						"from": {
							"type": "array",
							"description": "Array of source allowed to have network access to your service",
							"default": [],
							"x-form": {
								"hidden": true,
								"value": "{{region.from}}"
							},
							"x-onyxia": {
								"hidden": true,
								"overwriteDefaultWith": "region.from"
							}
						}
					}
				}
			}
		},
		"postgresql": {
			"description": "postgres specific configuration",
			"type": "object",
			"title": "Database",
			"properties": {
				"image": {
					"description": "image specific configuration",
					"type": "object",
					"properties": {
						"tag": {
							"description": "postgresql major version",
							"type": "string",
							"enum": ["12", "13", "14", "15"],
							"default": "15"
						}
					}
				},
				"auth": {
					"description": "postgres specific configuration",
					"type": "object",
					"title": "Authentification",
					"properties": {
						"username": {
							"type": "string",
							"title": "User",
							"default": "user",
							"x-form": {
								"value": "{{project.id}}"
							},
							"x-onyxia": {
								"overwriteDefaultWith": "{{project.id}}"
							}
						},
						"password": {
							"type": "string",
							"title": "User Password",
							"default": "changeme",
							"x-form": {
								"value": "{{project.password}}"
							},
							"x-onyxia": {
								"overwriteDefaultWith": "{{project.password}}"
							}
						},
						"postgresPassword": {
							"type": "string",
							"title": "Admin Password",
							"default": "changeme",
							"x-form": {
								"value": "{{project.password}}"
							},
							"x-onyxia": {
								"overwriteDefaultWith": "{{project.password}}"
							}
						},
						"database": {
							"description": "Name for the default database that is created when the image is first started.",
							"type": "string",
							"title": "Database",
							"default": "cloudbeaver"
						}
					}
				}
			}
		},
		"discovery": {
			"description": "configure your service to autodetect some ressources.",
			"type": "object",
			"properties": {
				"postgres": {
					"type": "boolean",
					"title": "Enable Postgres discovery",
					"description": "discover your PostgreSQL service",
					"default": true
				},
				"mariadb": {
					"type": "boolean",
					"title": "Enable mariadb discovery",
					"description": "discover your MariaDB service",
					"default": true
				},
				"trino": {
					"type": "boolean",
					"title": "Enable Trino discovery",
					"description": "discover your Trino service",
					"default": true
				}
			}
		},
		"ingress": {
			"type": "object",
			"form": true,
			"title": "Ingress Details",
			"properties": {
				"enabled": {
					"description": "Enable Ingress",
					"type": "boolean",
					"default": true,
					"x-onyxia": {
						"hidden": true,
						"overwriteDefaultWith": "k8s.ingress"
					}
				},
				"hostname": {
					"type": "string",
					"form": true,
					"title": "Hostname",
					"x-form": {
						"hidden": true,
						"value": "{{project.id}}-{{k8s.randomSubdomain}}.{{k8s.domain}}"
					},
					"x-onyxia": {
						"hidden": true,
						"overwriteDefaultWith": "{{project.id}}-{{k8s.randomSubdomain}}.{{k8s.domain}}"
					}
				},
				"ingressClassName": {
					"type": "string",
					"form": true,
					"title": "ingressClassName",
					"default": "",
					"x-form": {
						"hidden": true,
						"value": "{{k8s.ingressClassName}}"
					},
					"x-onyxia": {
						"hidden": true,
						"overwriteDefaultWith": "{{k8s.ingressClassName}}"
					}
				}
			}
		},
		"route": {
			"type": "object",
			"form": true,
			"title": "Route details",
			"properties": {
				"enabled": {
					"description": "Enable route",
					"type": "boolean",
					"default": false,
					"x-onyxia": {
						"hidden": true,
						"overwriteDefaultWith": "k8s.route"
					}
				},
				"hostname": {
					"type": "string",
					"form": true,
					"title": "Hostname",
					"x-onyxia": {
						"hidden": true,
						"overwriteDefaultWith": "{{project.id}}-{{k8s.randomSubdomain}}.{{k8s.domain}}"
					}
				}
			}
		}
	}
}
